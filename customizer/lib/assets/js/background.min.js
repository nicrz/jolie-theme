!function(e,t){"use strict";wp.customize.controlConstructor["vamtam-background"]=wp.customize.Control.extend({ready:function(){var e=this,t={};_.each(e.params.default,function(i,n){!1!==i&&(t[n]=i,e.params.value[n]!==e.setting._value[n]&&e.params.value.hasOwnProperty(n)&&(e.setting._value[n]=e.params.value[n]),void 0!==e.setting._value[n]&&(t[n]=e.setting._value[n]))}),_.each(e.setting._value,function(e,i){void 0!==t[i]&&void 0!==t[i]||(t[i]=e)}),e.value=t,e.params.value=t,_.bindAll(e,"removeFile","openFrame","select"),e.container.on("click keydown",".upload-button",e.openFrame),e.container.on("click keydown",".thumbnail-image img",e.openFrame),e.container.on("click keydown",".remove-button",e.removeFile),VAMTAM_CUSTOMIZER.controls.addSelectsChangeHandlers(this,t),VAMTAM_CUSTOMIZER.controls.addInputsChangeHandlers(this,t),e.initializeColorPickers(),e.container.on("change",'.background-type input[type="radio"], .background-gradient-type select',function(){e.renderContent(),e.initializeColorPickers()})},initializeColorPickers:function(){VAMTAM_CUSTOMIZER.controls.addColorPickerHandlers(this,this.value)},openFrame:function(e){wp.customize.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.frame||this.initFrame(),this.frame.open())},initFrame:function(){this.frame=wp.media({button:{text:this.params.button_labels.frame_button},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:this.params.mime_type}),multiple:!1,date:!1})]}),this.frame.on("select",this.select)},select:function(){var e=this.frame.state().get("selection").first().toJSON();this.setImage(e)},removeFile:function(e){wp.customize.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.setImage({}))},setImage:function(e){this.value["background-image"]=e?e.url:"",this.value["background-image-attachment"]=e||"",VAMTAM_CUSTOMIZER.controls.saveValue(this.value,this),this.renderContent(),this.initializeColorPickers()}})}(jQuery);